FROM redhat/ubi8:latest

# Install only the minimal dependencies needed
RUN dnf update -y && \
    dnf install -y \
        perl-FindBin \
        clang \
        clang-devel \
        llvm-devel \
        gcc \
        gcc-c++ \
        make \
        cmake \
        git \
        autoconf \
        automake \
        libtool \
        pkgconfig \
        perl \
        python3 \
        diffutils \
        gettext \
        wget
        
# Set environment variables for non-interactive installation
ENV RUSTUP_HOME=/usr/local/rustup \
    CARGO_HOME=/usr/local/cargo \
    PATH=/usr/local/cargo/bin:$PATH

# Install rustup and Rust 1.88.0
RUN curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | \
    sh -s -- -y --default-toolchain 1.88.0 && \
    chmod -R a+w $RUSTUP_HOME $CARGO_HOME

# Verify installation
RUN rustc --version && cargo --version

# Set workdir in dedicated folder
WORKDIR /app/